{"version":3,"sources":["../utils/index.js","../utils/Http.js","../utils/Download.js","../utils/project.js","download/project.js"],"names":["log4js","require","tempdir","os","tmpdir","exitCli","process","exit","getLog4jsInstance","configure","appenders","lxl","type","filename","path","join","categories","default","level","getLogger","saveCertificate","value","Error","confPath","fs","writeFile","err","getCertificate","existsSync","readFileSync","encoding","log","info","console","error","Header","Accept","COURSE_TEST_URL","TAPD_TEST_URL","Http","constructor","timeout","withCredentials","request","option","conf","maxRedirects","instance","axios","create","createRequestOption","referer","customConf","customHeader","headers","Referer","validCourseToken","token","successCallbackFunc","errorCallbackFunc","testUrl","http","client","then","resp","debug","data","status","code","catch","responseType","downloadFile","url","fullPath","response","get","pipe","createWriteStream","Promise","resolve","reject","on","endsWith","message","templateFileContent","__dirname","getDownloadUrl","entranceUrl","saveTargetDir","htmlString","$","cheerio","load","downloadATagsArr","filter","i","el","attr","toArray","forEach","downloadUrl","saveTargetName","pinyin","convertToPinyin","text","createFileOrDire","_path","callback","dirname","mkdirSync","writeFileSync","recursive","addCourseConfFile","basicCourseInfoStr","saveFullPath","newTemplateFileContent","cwd","content","createProjectStructureDirc","projectId","rootPath","randomNum2TitleDir","getDircStructure","titleArr","map","_","e","title","find","randomNum","Math","random","pinyinTitle","replace","directoryName","fullDirectoryName","subTitleArr","slice","storyId","sourceUrl","success","Project","pid","createStructureState","setCreateStructureState","React","useState","useEffect","result","propTypes","PropTypes","string","isRequired"],"mappings":"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","file":"project.js","sourceRoot":"..\\..\\commands","sourcesContent":["import fs from 'fs'\r\nimport os, { type } from 'os'\r\nimport path from 'path'\r\nconst log4js = require('log4js')\r\n// basic vars\r\nconst tempdir = os.tmpdir()\r\n// 通用退出函数\r\nconst exitCli = () => process.exit()\r\n\r\nconst getLog4jsInstance = () => {\r\n  log4js.configure({\r\n    appenders: {\r\n      lxl: { type: 'file', filename: path.join(tempdir, 'lxl.log') }\r\n    },\r\n    categories: { default: { appenders: ['lxl'], level: 'debug' } }\r\n  })\r\n  return log4js.getLogger('lxl')\r\n}\r\n\r\nconst saveCertificate = (type = 'course', value) => {\r\n  if (type !== 'course' && type !== 'tapd') {\r\n    throw new Error('暂不支持的凭证类型')\r\n  }\r\n  const confPath = path.join(tempdir, `${type}.txt`)\r\n  fs.writeFile(confPath, value, (err) => {\r\n    if (err) throw new Error('save certificate failed.')\r\n  })\r\n}\r\n\r\n// get certificate and check valid\r\nconst getCertificate = (type = 'course') => {\r\n  if (type !== 'course' && type !== 'tapd') {\r\n    throw new Error('暂不支持的凭证类型')\r\n  }\r\n  const confPath = path.join(tempdir, `${type}.txt`)\r\n  try {\r\n    if (fs.existsSync(confPath)) {\r\n      return fs.readFileSync(confPath, { encoding: 'utf8' })\r\n    } else {\r\n      log.info('先使用 lxl build init 命令进行初始化再重新运行程序.')\r\n      console.log('先使用 lxl build init 命令进行初始化再重新运行程序.')\r\n      exitCli()\r\n    }\r\n  } catch (error) {\r\n    throw new Error('read certificate failed.')\r\n  }\r\n}\r\n\r\nexport { tempdir, getCertificate, saveCertificate, getLog4jsInstance, exitCli }\r\n","import axios from 'axios'\nimport {\n  // exitCli,\n  getCertificate,\n  getLog4jsInstance,\n  saveCertificate\n} from './index'\n\nconst Header = {\n  'User-Agent':\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36',\n  Accept: 'application/json, text/plain, */*',\n  'Content-Type': 'application/json;charset=UTF-8'\n}\n\nconst COURSE_TEST_URL = 'http://course.suboy.cn/cgi/auth/build/course/list'\nconst TAPD_TEST_URL =\n  'https://www.tapd.cn/company/participant_projects?from=left_tree2'\n\nexport default class Http {\n  constructor () {\n    this.timeout = 6000\n    this.withCredentials = true\n  }\n\n  /*\n   * option 需要提供 header dict, baseURL\n   */\n  request (option) {\n    const conf = {\n      ...option,\n      timeout: this.timeout,\n      withCredentials: this.withCredentials,\n      maxRedirects: 0\n    }\n    const instance = axios.create(conf)\n    return instance\n  }\n\n  // createInstance\n}\n\nfunction createRequestOption (\n  type = 'course',\n  referer = 'http://course.suboy.cn/',\n  customConf = {},\n  customHeader = null\n) {\n  const conf = {\n    headers: {\n      ...(customHeader === null ? Header : customHeader),\n      [type === 'course' ? 'token' : 'cookie']: getCertificate(type),\n      Referer: referer\n    },\n    ...customConf\n  }\n  return conf\n}\n\nfunction validCourseToken (type, token, successCallbackFunc, errorCallbackFunc) {\n  const log = getLog4jsInstance()\n  const testUrl = type === 'course' ? COURSE_TEST_URL : TAPD_TEST_URL\n  const http = new Http()\n  const client = http.request({\n    headers: {\n      [type === 'course' ? 'token' : 'cookie']: token,\n      ...Header\n    }\n  })\n  client[type === 'course' ? 'post' : 'get'](testUrl)\n    .then((resp) => {\n      log.info('start check token/cookie valid...')\n      log.debug(resp.data, resp.status)\n      if (resp.data.code === 0 || resp.status === 200) {\n        saveCertificate(type, token)\n        successCallbackFunc()\n      } else {\n        errorCallbackFunc(resp.data)\n      }\n    })\n    .catch((err) => errorCallbackFunc(err))\n}\n\nexport { Header, validCourseToken, createRequestOption }\n","import fs from 'fs'\nimport { getLog4jsInstance, exitCli } from './index'\nimport Http, { createRequestOption } from './Http'\n\nconst http = new Http()\nconst client = http.request(createRequestOption('tapd', 'https://tapd.cn/company/participant_projects', {\n  responseType: 'stream'\n}))\nconst log = getLog4jsInstance()\n\n// TODO 提供地址和保存位置全名即可下载\nconst downloadFile = async (url, fullPath) => {\n  try {\n    const response = await client.get(url)\n    // pipe the result stream into a file on disc\n    response.data.pipe(fs.createWriteStream(fullPath))\n\n    // return a promise and resolve when download finishes\n    return new Promise((resolve, reject) => {\n      response.data.on('end', () => {\n        log.info('success.', fullPath)\n        // extrand the file\n        if (fullPath.endsWith('.zip') || fullPath.endsWith('.rar') || fullPath.endsWith('.7z')) {\n          //\n        }\n        resolve()\n      })\n      response.data.on('error', () => {\n        log.error('download file failed:', fullPath)\n        reject(new Error('Download Failed'))\n      })\n    })\n  } catch (error) {\n    log.error(error.message)\n    exitCli()\n  }\n}\n\nexport { downloadFile }\n","import fs from 'fs'\nimport path from 'path'\nimport { downloadFile } from './Download.js'\nimport Http, { createRequestOption } from './Http.js'\nimport * as cheerio from 'cheerio'\nimport * as pinyin from 'tiny-pinyin'\nimport { getLog4jsInstance } from './index'\nconst http = new Http()\nconst client = http.request(\n  createRequestOption('tapd', 'https://tapd.cn/company/participant_projects')\n)\nconst templateFileContent = fs.readFileSync(path.join(__dirname, 'course.conf'), 'utf8')\nconst log = getLog4jsInstance()\n\nconst getDownloadUrl = async (entranceUrl, saveTargetDir) => {\n  try {\n    const resp = await client.get(entranceUrl)\n    const htmlString = resp.data\n    const $ = cheerio.load(htmlString)\n    const downloadATagsArr = $('a.link-title').filter(function (i, el) {\n      return $(this).attr('title') === '本地下载'\n    }).toArray()\n    downloadATagsArr.forEach(async (el) => {\n      const downloadUrl = $(el).attr('href')\n      const saveTargetName = pinyin.convertToPinyin($(el).text(), '', true)\n      if (!(saveTargetName.endsWith('mp4') || saveTargetName.endsWith('fla'))) {\n        await downloadFile(downloadUrl, path.join(saveTargetDir, saveTargetName))\n      }\n    })\n    return Promise.resolve(1)\n  } catch (error) {\n    log.error(error.message)\n    return Promise.reject(error.message)\n  }\n}\n\n/**\n * @param {type} _path 默认路径\n * @param {type} type = 文件名/目录名\n * @param {type} callback = 回调函数\n */\nconst createFileOrDire = (_path, type = 'file', callback = null) => {\n  if (type === 'file' && fs.existsSync(path.dirname(_path))) {\n    fs.mkdirSync(path.dirname(_path))\n  }\n  // let newPath = vim\n  type === 'file' ? fs.writeFileSync(_path) : fs.mkdirSync(_path, { recursive: true })\n  if (callback !== null) callback()\n}\n\nconst addCourseConfFile = (basicCourseInfoStr, saveFullPath) => {\n  const newTemplateFileContent = fs.existsSync(path.join(process.cwd(), 'course.conf')) ? fs.readFileSync(path.join(process.cwd(), 'course.conf'), 'utf8') : templateFileContent\n  const content = basicCourseInfoStr + newTemplateFileContent\n  fs.writeFileSync(saveFullPath, content, {\n    encoding: 'utf8'\n  })\n}\n\n/**\n * @param {type} projectId 按id获取课件项目结构体系,创建目录\n * @param {string} rootPath default is current directory\n */\nconst createProjectStructureDirc = (projectId, rootPath) => {\n  const randomNum2TitleDir = {}\n  const getDircStructure = async () => {\n    try {\n      const resp = await client.get(\n        `https://www.tapd.cn/${projectId}/prong/stories/stories_list`\n      )\n      const htmlString = resp.data\n      const $ = cheerio.load(htmlString)\n      const titleArr = $('tr')\n        .filter(function (i, el) {\n          // this == el\n          return $(this)\n            .attr('level') === '0'\n        })\n      // 获取每一小节的标题,创建小节的目录结构\n      titleArr.map((_, e) => {\n        const title = $(e).find('.name-td')\n          .attr('data-editable-value') || 'unknown'\n        const randomNum = ~~(Math.random() * 8999 + 1000)\n        const pinyinTitle = pinyin.convertToPinyin(`${title}${randomNum}`, '', true).replace(/[,!.。，！]/g, '')\n        randomNum2TitleDir[title] = randomNum\n        const directoryName = pinyinTitle\n        const fullDirectoryName = path.join(rootPath, directoryName)\n        createFileOrDire(path.join(fullDirectoryName, 'static', 'picture', 'jiaoan'), 'directory')\n        createFileOrDire(path.join(fullDirectoryName, 'static', 'json'), 'directory')\n        createFileOrDire(path.join(fullDirectoryName, 'static', 'mp3'), 'directory')\n        addCourseConfFile(`title=${title}` + '\\n' + `course_name=_${pinyinTitle}` + '\\n', path.join(fullDirectoryName, 'course.conf'))\n      })\n\n      // 下载每一小节的附件并且解压到此小节的拼音目录下\n      const subTitleArr = $('tr')\n        .filter(function (i, el) {\n          // this equal element\n          return $(this).attr('level') === '1'\n        })\n      subTitleArr.slice(0, 6).map(async (_, e) => {\n        const title = $(e).find('.editable-td a').text()\n        // 获取上级标题的拼音版本，去掉尾部数字\n        const pinyinTitle = pinyin.convertToPinyin(title, '', true).replace(/\\d{1,2}$/, '').replace(/[,!.。、，！]/g, '')\n        const storyId = $(e).attr('story_id')\n        const sourceUrl = `https://www.tapd.cn/${projectId}/attachments/attachments_list/story/${storyId}/${projectId}`\n        await getDownloadUrl(sourceUrl, path.join(rootPath, `${pinyinTitle}${randomNum2TitleDir[title]}`))\n      })\n\n      return {\n        success: true,\n        // data:\n        data: 'ok'\n      }\n    } catch (error) {\n      return {\n        success: false,\n        data: error.message\n      }\n    }\n  }\n  return getDircStructure()\n}\n\nexport { createProjectStructureDirc }\n","// eslint-disable-next-line no-unused-vars\nimport React from 'react'\n// eslint-disable-next-line no-unused-vars\nimport { Text, Box } from 'ink'\nimport PropTypes from 'prop-types'\nimport { createProjectStructureDirc } from '../../utils/project.js'\n\n/// lxl download project --pid=xxx\nconst Project = ({ pid, rootPath = '.' }) => {\n  const [createStructureState, setCreateStructureState] = React.useState({})\n  React.useEffect(() => {\n    const result = createProjectStructureDirc('35381138', rootPath)\n    setCreateStructureState(result)\n  }, [])\n  return (\n    <Box>\n      <Text>download project: {pid}</Text>\n      {\n        createStructureState.success === true ? <Text>1</Text> : <Text>2</Text>\n      }\n      {\n        createStructureState.success === false ? <Text>3</Text> : <Text>4</Text>\n      }\n    </Box>\n  )\n}\n\nProject.propTypes = {\n  pid: PropTypes.string.isRequired,\n  rootPath: PropTypes.string\n}\n\nexport default Project\n"]}